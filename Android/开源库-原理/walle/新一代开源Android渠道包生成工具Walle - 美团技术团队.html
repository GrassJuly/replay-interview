<!DOCTYPE html>
<!-- saved from url=(0072)https://tech.meituan.com/2017/01/13/android-apk-v2-signature-scheme.html -->
<html lang="en" dir="ltr" class=" theme-united"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="renderer" content="webkit"><meta http-equiv="x-ua-compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="soulteary@gmail.com"><script type="text/javascript" async="" src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/analytics.js"></script><script src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/hm.js"></script><script type="text/javascript" async="" src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/js"></script><script type="text/javascript" async="" src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/analytics.js"></script><script async="" src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/js(1)"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-158867676-1');</script><meta name="robots" content="index, follow"><meta property="og:title" content="新一代开源Android渠道包生成工具Walle"><meta property="og:description" content="本文介绍美团App的Android版所用的新一代渠道生成工具Walle，能够在完美支持Android 7.0新的APK Signature Scheme v2的同时，快速生成渠道包。项目已经开源。"><meta property="og:type" content="article"><meta property="og:url" content="https://tech.meituan.com/2017/01/13/android-apk-v2-signature-scheme.html"><meta property="article:published_time" content="2017-01-13T00:00:00+00:00"><meta property="article:modified_time" content="2017-01-13T00:00:00+00:00"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="新一代开源Android渠道包生成工具Walle"><meta name="twitter:description" content="本文介绍美团App的Android版所用的新一代渠道生成工具Walle，能够在完美支持Android 7.0新的APK Signature Scheme v2的同时，快速生成渠道包。项目已经开源。"><meta name="description" content="本文介绍美团App的Android版所用的新一代渠道生成工具Walle，能够在完美支持Android 7.0新的APK Signature Scheme v2的同时，快速生成渠道包。项目已经开源。"><meta name="keywords" content="前端,美旅技术,开源,Android,Android N,渠道包,META-INFO,V2 Signature,移动,餐饮,Walle,"><link rel="canonical" href="https://tech.meituan.com/2017/01/13/android-apk-v2-signature-scheme.html"><title>新一代开源Android渠道包生成工具Walle - 美团技术团队</title><link rel="stylesheet" href="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/common.css"><link rel="stylesheet" href="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/post.css"><link rel="apple-touch-icon" sizes="180x180" href="https://awps-assets.meituan.net/mit/blog/v20190629/asset/icon/apple-icon-180x180.png?v=Whistle&amp;t=20181017-1r"><link rel="icon" type="image/png" sizes="192x192" href="https://awps-assets.meituan.net/mit/blog/v20190629/asset/icon/android-icon-192x192.png?v=Whistle&amp;t=20181017-1r"><link rel="shortcut icon" href="https://awps-assets.meituan.net/mit/blog/v20190629/asset/icon/favicon.ico?v=Whistle&amp;t=20181017-1r"><script>top!=self&&top.host!=self.host&&(top.location=self.location);(function(d){d.className=d.className.replace(/\bno-js/,'');})(document.documentElement);var $CONFIG={'data':{}};</script><link href="https://tech.meituan.com/feed/" rel="alternate" type="application/rss+xml" title="新一代开源Android渠道包生成工具Walle"><script src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/zepto.min.js"></script><script src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/common.js"></script></head><body class="page page-type-post"><nav class="navbar navbar-default g-navbar-box hidden-print" id="Js_page-navbar"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
<span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
<a class="navbar-brand" href="https://tech.meituan.com/" title="美团技术团队" target="_self">美团技术团队</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right" id="JS_nav_list"><li class="menu-item menu-item-home"><a class="menu-item-link" href="https://tech.meituan.com/" target="_self" title="查看最新文章">最新文章</a></li><li class="menu-item menu-item-archive"><a class="menu-item-link" href="https://tech.meituan.com/archives" target="_self" title="查看文章存档内容">文章存档</a></li><li class="menu-item menu-item-salon"><a class="menu-item-link" href="https://tech.meituan.com/tech-salon" target="_self" title="了解技术沙龙">技术沙龙</a></li><li class="menu-item menu-item-about"><a class="menu-item-link" href="https://tech.meituan.com/about" target="_self" title="了解更多关于我们的事情">关于我们</a></li></ul></div><div class="navbar-bottom"><p class="copyright">© 2019 美团技术团队</p><p class="copyright">All rights reserved.</p></div></nav><div class="container-fluid main-container" id="J_main-container"><div class="row"><div class="col-md-12"><div class="post-container"><h1 class="post-title"><a href="https://tech.meituan.com/2017/01/13/android-apk-v2-signature-scheme.html" rel="bookmark">新一代开源Android渠道包生成工具Walle</a></h1><div class="meta-box"><span class="m-post-date"><i class="fa fa-calendar-o"></i>2017年01月13日</span>
<span class="m-post-nick">作者: 建帅 陈潼</span>
<span class="m-post-permalink"><i class="fa fa-link-o"></i><a href="https://tech.meituan.com/2017/01/13/android-apk-v2-signature-scheme.html" target="_blank">文章链接</a></span>
<span class="m-post-count"><i class="fa fa-pencil"></i>4985字</span>
<span class="m-post-reading"><i class="fa fa-hourglass-start"></i>10分钟阅读</span></div><div class="post-content"><div class="content"><p>在Android 7.0（Nougat）推出了新的应用签名方案APK Signature Scheme v2后，之前快速生成渠道包的方式（<a href="http://tech.meituan.com/mt-apk-packaging.html">美团Android自动化之旅—生成渠道包<i class="fa fa-link" aria-hidden="true"></i></a>）已经行不通了，在此应用签名方案下如何快速生成渠道包呢？</p><p>本文会对新的应用签名方案APK Signature Scheme v2以及新一代渠道生成工具进行详细深入的介绍。</p><h2 id="新的应用签名方案apk-signature-scheme-v2">新的应用签名方案APK Signature Scheme v2</h2><p>Android 7.0（Nougat）引入一项新的应用签名方案<a href="https://source.android.com/security/apksigning/v2.html">APK Signature Scheme v2<i class="fa fa-link" aria-hidden="true"></i></a>，它是一个对全文件进行签名的方案，能提供更快的应用安装时间、对未授权APK文件的更改提供更多保护，在默认情况下，Android Gradle 2.2.0插件会使用APK Signature Scheme v2和传统签名方案来签署你的应用。</p><p>下面以 <code>新的应用签名方案</code> 来指APK Signature Scheme v2。</p><p>目前该方案不是强制性的，在 <code>build.gradle</code> 添加 <code>v2SigningEnabled false</code> ，就能使用传统签名方案来签署我们的应用（见下面的代码片段）。</p><pre><code class="language-groovy hljs">  android {
    ...
    defaultConfig { ... }
    signingConfigs {
      release {
        storeFile file(<span class="hljs-string"><span class="hljs-string">"myreleasekey.keystore"</span></span>)
        storePassword <span class="hljs-string"><span class="hljs-string">"password"</span></span>
        keyAlias <span class="hljs-string"><span class="hljs-string">"MyReleaseKey"</span></span>
        keyPassword <span class="hljs-string"><span class="hljs-string">"password"</span></span>
        v2SigningEnabled <span class="hljs-literal"><span class="hljs-literal">false</span></span>
      }
    }
  }
</code></pre><p>但新的应用签名方案有着良好的向后兼容性，能完全兼容低于Android 7.0（Nougat）的版本。对比旧签名方案，它有更快的验证速度和更安全的保护，因此新的应用签名方案可能会被采纳成一个强制配置，笔者认为现在有必要对现有的渠道包生成方式进行检查、升级或改造来支持新的应用签名方案。</p><p>新的签名方案对已有的渠道生成方案有什么影响呢？下图是新的应用签名方案和旧的签名方案的一个对比：</p><p><img src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/604a4dc5.png" alt=""></p><p>新的签名方案会在ZIP文件格式的 <code>Central Directory</code> 区块所在文件位置的前面添加一个APK Signing Block区块，下面按照ZIP文件的格式来分析新应用签名方案签名后的APK包。</p><p>整个APK（ZIP文件格式）会被分为以下四个区块：
1. Contents of ZIP entries（from offset 0 until the start of APK Signing Block）
2. APK Signing Block
3. ZIP Central Directory
4. ZIP End of Central Directory</p><p><img src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/b6ff18f5.png" alt="" class=""></p><p>新应用签名方案的签名信息会被保存在区块2（APK Signing Block）中， 而区块1（<code>Contents of ZIP entries</code>）、区块3（<code>ZIP Central Directory</code>）、区块4（<code>ZIP End of Central Directory</code>）是受保护的，在签名后任何对区块1、3、4的修改都逃不过新的应用签名方案的检查。</p><p>之前的渠道包生成方案是通过在META-INF目录下添加空文件，用空文件的名称来作为渠道的唯一标识，之前在META-INF下添加文件是不需要重新签名应用的，这样会节省不少打包的时间，从而提高打渠道包的速度。但在新的应用签名方案下META-INF已经被列入了保护区了，向META-INF添加空文件的方案会对区块1、3、4都会有影响，新应用签名方案签署的应用经过我们旧的生成渠道包方案处理后，在安装时会报以下错误：</p><pre><code class="hljs armasm"><span class="hljs-symbol"><span class="hljs-symbol">Failure</span></span> [INSTALL_PARSE_FAILED_NO_CERTIFICATES: 
<span class="hljs-symbol"><span class="hljs-symbol">Failed</span></span> to collect certificates from <span class="hljs-keyword"><span class="hljs-keyword">base.apk: </span></span>META-INF/CERT.SF indicates <span class="hljs-keyword"><span class="hljs-keyword">base.apk </span></span>is signed using APK Signature Scheme <span class="hljs-built_in"><span class="hljs-built_in">v2</span></span>, 
<span class="hljs-keyword"><span class="hljs-keyword">but </span></span>no such signature was found. Signature <span class="hljs-keyword"><span class="hljs-keyword">stripped?]
</span></span></code></pre><p>目前另外一种比较流行的<a href="http://linghaolu.github.io/apk/2016/04/02/apk-comment.html">渠道包快速生成方案<i class="fa fa-link" aria-hidden="true"></i></a>（往APK中添加ZIP Comment）也因为上述原因，无法在新的应用签名方案下进行正常工作。</p><p>如果新的应用签名方案后续改成强制要求，那我们现有的生成渠道包的方式就会无法工作，那我们难道要退回到解放前，通过传统的方式（例如：使用APKTool逆向工具、采用Flavor ＋ BuildType等比较耗时的方案来进行渠道包打包）来生成支持新应用签名方案的渠道包吗？</p><p>如果只有少量渠道包的场景下，这种耗时时长还能够勉强接受。但是目前我们有将近900个渠道，如果采用传统方式打完所有的渠道包需要近3个小时，这是不能接受的。</p><p>那我们有没有其他更好的渠道包生成方式，既能支持新的应用签名方案，又能体验毫秒级的打包耗时呢？我们来分析一下新方案中的区块2——Block。</p><h2 id="可扩展的apk-signature-scheme-v2-block">可扩展的APK Signature Scheme v2 Block</h2><p>通过上面的描述，可以看出因为APK包的区块1、3、4都是受保护的，任何修改在签名后对它们的修改，都会在安装过程中被签名校验检测失败，而区块2（APK Signing Block）是不受签名校验规则保护的，那是否可以在这个不受签名保护的区块2（APK Signing Block）上做文章呢？我们先来看看对区块2格式的描述：</p><table><thead><tr><th>偏移</th><th align="center">字节数</th><th align="left">描述</th></tr></thead><tbody><tr><td>@+0</td><td align="center">8</td><td align="left">这个Block的长度（本字段的长度不计算在内）</td></tr><tr><td>@+8</td><td align="center">n</td><td align="left">一组ID-value</td></tr><tr><td>@-24</td><td align="center">8</td><td align="left">这个Block的长度（和第一个字段一样值）</td></tr><tr><td>@-16</td><td align="center">16</td><td align="left">魔数 “APK Sig Block 42”</td></tr></tbody></table><p>区块2中APK Signing Block是由这几部分组成：2个用来标示这个区块长度的8字节 ＋ 这个区块的魔数（<code>APK Sig Block 42</code>）+ 这个区块所承载的数据（ID-value）。</p><p>我们重点来看一下这个ID-value，它由一个8字节的长度标示＋4字节的ID＋它的负载组成。V2的签名信息是以ID（<code>0x7109871a</code>）的ID-value来保存在这个区块中，不知大家有没有注意这是一组ID-value，也就是说它是可以有若干个这样的ID-value来组成，那我们是不是可以在这里做一些文章呢？</p><p>为了验证我们的想法，先来看看新的应用签名方案是怎么验证签名信息的，见下图：</p><p><img src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/18666479.png" alt=""></p><p>通过上图可以看出新的应用签名方案的验证过程：
1. 寻找APK Signing Block，如果能够找到，则进行验证，验证成功则继续进行安装，如果失败了则终止安装
2. 如果未找到APK Signing Block，则执行原来的签名验证机制，也是验证成功则继续进行安装，如果失败了则终止安装</p><p>那Android应用在安装时新的应用签名方案是怎么进行校验的呢？笔者通过翻阅Android相关部分的源码，发现下面代码段是用来处理上面所说的ID-value的：</p><pre><code class="language-java hljs">    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ByteBuffer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findApkSignatureSchemeV2Block</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(
            ByteBuffer apkSigningBlock,
            Result result)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> SignatureNotFoundException </span></span>{
        checkByteOrderLittleEndian(apkSigningBlock);
        <span class="hljs-comment"><span class="hljs-comment">// FORMAT:</span></span>
        <span class="hljs-comment"><span class="hljs-comment">// OFFSET       DATA TYPE  DESCRIPTION</span></span>
        <span class="hljs-comment"><span class="hljs-comment">// * @+0  bytes uint64:    size in bytes (excluding this field)</span></span>
        <span class="hljs-comment"><span class="hljs-comment">// * @+8  bytes pairs</span></span>
        <span class="hljs-comment"><span class="hljs-comment">// * @-24 bytes uint64:    size in bytes (same as the one above)</span></span>
        <span class="hljs-comment"><span class="hljs-comment">// * @-16 bytes uint128:   magic</span></span>
        ByteBuffer pairs = sliceFromTo(apkSigningBlock, <span class="hljs-number"><span class="hljs-number">8</span></span>, apkSigningBlock.capacity() - <span class="hljs-number"><span class="hljs-number">24</span></span>);

        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> entryCount = <span class="hljs-number"><span class="hljs-number">0</span></span>;
        <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (pairs.hasRemaining()) {
            entryCount++;
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pairs.remaining() &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) {
                <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignatureNotFoundException(
                        <span class="hljs-string"><span class="hljs-string">"Insufficient data to read size of APK Signing Block entry #"</span></span> + entryCount);
            }
            <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> lenLong = pairs.getLong();
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((lenLong &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) || (lenLong &gt; Integer.MAX_VALUE)) {
                <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignatureNotFoundException(
                        <span class="hljs-string"><span class="hljs-string">"APK Signing Block entry #"</span></span> + entryCount
                                + <span class="hljs-string"><span class="hljs-string">" size out of range: "</span></span> + lenLong);
            }
            <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) lenLong;
            <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextEntryPos = pairs.position() + len;
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len &gt; pairs.remaining()) {
                <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignatureNotFoundException(
                        <span class="hljs-string"><span class="hljs-string">"APK Signing Block entry #"</span></span> + entryCount + <span class="hljs-string"><span class="hljs-string">" size out of range: "</span></span> + len
                                + <span class="hljs-string"><span class="hljs-string">", available: "</span></span> + pairs.remaining());
            }
            <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id = pairs.getInt();
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id == APK_SIGNATURE_SCHEME_V2_BLOCK_ID) {
                <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getByteBuffer(pairs, len - <span class="hljs-number"><span class="hljs-number">4</span></span>);
            }
            result.addWarning(Issue.APK_SIG_BLOCK_UNKNOWN_ENTRY_ID, id);
            pairs.position(nextEntryPos);
        }

        <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignatureNotFoundException(
                <span class="hljs-string"><span class="hljs-string">"No APK Signature Scheme v2 block in APK Signing Block"</span></span>);
    }
</code></pre><p>上述代码中关键的一个位置是 <code>if (id == APK_SIGNATURE_SCHEME_V2_BLOCK_ID) {return getByteBuffer(pairs, len - 4);}</code>，通过源代码可以看出Android是通过查找ID为 <code>APK_SIGNATURE_SCHEME_V2_BLOCK_ID = 0x7109871a</code> 的ID-value，来获取APK Signature Scheme v2 Block，对这个区块中其他的ID-value选择了忽略。</p><p>在<a href="https://source.android.com/security/apksigning/v2.html">APK Signature Scheme v2<i class="fa fa-link" aria-hidden="true"></i></a>中没有看到对无法识别的ID，有相关处理的介绍。</p><p>当看到这里时，我们可不可以设想一下，提供一个自定义的ID-value并写入该区域，从而为快速生成渠道包服务呢？</p><p>怎么向ID-value中添加信息呢？通过阅读ZIP的文件格式和APK Signing Block格式的描述，笔者通过编写下面的代码片段进行验证，发现通过在已经被新的应用签名方案签名后的APK中添加自定义的ID-value，是不需要再次经过签名就能安装的，下面是部分代码片段。</p><pre><code class="language-java hljs">  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeApkSigningBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataOutput dataOutput)</span></span></span><span class="hljs-function"> </span></span>{
        <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> length = <span class="hljs-number"><span class="hljs-number">24</span></span>;
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; payloads.size(); ++index) {
            ApkSigningPayload payload = payloads.get(index);
            <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = payload.getByteBuffer();
            length += <span class="hljs-number"><span class="hljs-number">12</span></span> + bytes.length;
        }

        ByteBuffer byteBuffer = ByteBuffer.allocate(Long.BYTES);
        byteBuffer.order(ByteOrder.LITTLE_ENDIAN);
        byteBuffer.putLong(length);
        dataOutput.write(byteBuffer.array());

        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; payloads.size(); ++index) {
            ApkSigningPayload payload = payloads.get(index);
            <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = payload.getByteBuffer();

            byteBuffer = ByteBuffer.allocate(Integer.BYTES);
            byteBuffer.order(ByteOrder.LITTLE_ENDIAN);
            byteBuffer.putInt(payload.getId());
            dataOutput.write(byteBuffer.array());

            dataOutput.write(bytes);
        }
        ...
    }
</code></pre><h2 id="新一代渠道包生成工具">新一代渠道包生成工具</h2><p>到这里为止一个新的渠道包生成方案逐步清晰了起来，下面是新一代渠道包生成工具的描述：</p><ol><li>对新的应用签名方案生成的APK包中的ID-value进行扩展，提供自定义ID－value（渠道信息），并保存在APK中</li><li>而APK在安装过程中进行的签名校验，是忽略我们添加的这个ID-value的，这样就能正常安装了</li><li>在App运行阶段，可以通过ZIP的<code>EOCD（End of central directory）</code>、<code>Central directory</code>等结构中的信息（会涉及ZIP格式的相关知识，这里不做展开描述）找到我们自己添加的ID-value，从而实现获取渠道信息的功能</li></ol><p>新一代渠道包生成工具完全是基于ZIP文件格式和APK Signing Block存储格式而构建，基于文件的二进制流进行处理，有着良好的处理速度和兼容性，能够满足不同的语言编写的要求，目前笔者采用的是Java＋Groovy开发， 该工具主要有四部分组成：
1. 用于写入ID-value信息的Java类库
2. Gradle构建插件用来和Android的打包流程进行结合
3. 用于读取ID-value信息的Java类库
4. 用于供<code>com.android.application</code>使用的读取渠道信息的AAR</p><p>这样，每打一个渠道包只需复制一个APK，然后在APK中添加一个ID-value即可，这种打包方式速度非常快，对一个30M大小的APK包只需要100多毫秒（包含文件复制时间）就能生成一个渠道包，而在运行时获取渠道信息只需要大约几毫秒的时间。</p><p>这个项目我们取名为Walle（瓦力），已经开源，项目的Github地址是： <a href="https://github.com/Meituan-Dianping/walle">https://github.com/Meituan-Dianping/walle<i class="fa fa-link" aria-hidden="true"></i></a> （求Issue、PR、Star）。希望业内有类似需求的团队能够在APK Signature Scheme V2签名下愉快地生成渠道包，同时也期待大家一起对该项目进行完善和优化。</p><h2 id="总结">总结</h2><p>以上就是我们对新的应用签名方案进行的分析，并根据它所带来的文件存储格式上的变化，找到了可以利用的ID-value，然后基于这个ID-value来构建我们新一代渠道包生成工具。</p><p>新一代渠道包生成工具能够满足新应用签名方案对安全性的要求，同时也能满足对渠道包打包时间的要求，至此大家生成渠道包的方式需要升级了！</p><p>文章中引用的图片来源于：<a href="https://source.android.com/security/apksigning/v2.html">https://source.android.com/security/apksigning/v2.html<i class="fa fa-link" aria-hidden="true"></i></a></p><h2 id="参考文献">参考文献</h2><ol><li><a href="https://source.android.com/security/apksigning/v2.html">APK Signature Scheme v2<i class="fa fa-link" aria-hidden="true"></i></a></li><li><a href="https://android.googlesource.com/platform/build/+/8740e9d">ApkSigner的源代码<i class="fa fa-link" aria-hidden="true"></i></a></li><li><a href="https://android.googlesource.com/platform/tools/apksig/">apksig的源代码<i class="fa fa-link" aria-hidden="true"></i></a></li><li>[ZIP Format](<a href="https://en.wikipedia.org/wiki/Zip_(file_format">https://en.wikipedia.org/wiki/Zip_(file_format<i class="fa fa-link" aria-hidden="true"></i></a>)</li></ol></div></div><div class="meta-box post-bottom-meta-box hidden-print"><span class="tag-links"><i class="fa fa-tags" aria-hidden="true"></i><a href="https://tech.meituan.com/tags/%E5%89%8D%E7%AB%AF.html" rel="tag">前端</a>, <a href="https://tech.meituan.com/tags/%E7%BE%8E%E6%97%85%E6%8A%80%E6%9C%AF.html" rel="tag">美旅技术</a>, <a href="https://tech.meituan.com/tags/%E5%BC%80%E6%BA%90.html" rel="tag">开源</a>, <a href="https://tech.meituan.com/tags/android.html" rel="tag">Android</a>, <a href="https://tech.meituan.com/tags/android-n.html" rel="tag">Android N</a>, <a href="https://tech.meituan.com/tags/%E6%B8%A0%E9%81%93%E5%8C%85.html" rel="tag">渠道包</a>, <a href="https://tech.meituan.com/tags/meta-info.html" rel="tag">META-INFO</a>, <a href="https://tech.meituan.com/tags/v2-signature.html" rel="tag">V2 Signature</a>, <a href="https://tech.meituan.com/tags/%E7%A7%BB%E5%8A%A8.html" rel="tag">移动</a>, <a href="https://tech.meituan.com/tags/%E9%A4%90%E9%A5%AE.html" rel="tag">餐饮</a>, <a href="https://tech.meituan.com/tags/walle.html" rel="tag">Walle</a></span></div><div class="row page-navigation-container hidden-print"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><div class="navigation-wrapper"><div class="pager"><div class="title-box"><i class="fa fa-paperclip"></i>#看看其他</div><a href="https://tech.meituan.com/2017/01/13/risk-control-system-experience-sharing.html" title="美团点评业务风控系统构建经验" class="previous"><span aria-hidden="true">前一篇: 美团点评业务风控系统构建经验</span></a>
<a href="https://tech.meituan.com/2017/01/19/clean-code.html" title="聊聊clean code" class="next"><span aria-hidden="true">后一篇: 聊聊clean code</span></a></div></div></div></div><div class="row page-comments-container hidden-print"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><div class="comments-wrapper hidden-print"><div id="comments" class="comments-disabled"><div class="title-box"><i class="fa fa-comments-o"></i>#一起聊聊</div><div class="post-feedback-box hidden-print"><p>如发现文章有错误、对内容有疑问，都可以关注美团技术团队微信公众号（meituantech），在后台给我们留言。</p><img class="qrcode" src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/7080c58988fc3e9e0b40645f06f31543666973.png" alt="美团技术团队微信二维码"><p class="follow-us">我们每周会挑选出一位热心小伙伴，送上一份精美的小礼品。快来扫码关注我们吧！</p></div></div></div></div></div></div></div></div></div><div class="container-fluid main-container" id="J_footer-container"><script>$CONFIG['data']['footerLink']=[{"name":"网站首页","link":"/"},{"name":"文章存档","link":"/archives"},{"name":"关于我们","link":"/about"}];</script><div class="row"><div class="col-md-12 footer-links-container"><div class="footer-divider"></div></div><div class="col-md-4"><p>一行代码，亿万生活。</p></div><div class="col-md-8"><ul class="nav nav-pills navbar-right"><li class="menu-item"><a href="https://tech.meituan.com/" title="">网站首页</a></li><li class="menu-item"><a href="https://tech.meituan.com/archives" title="">文章存档</a></li><li class="menu-item"><a href="https://tech.meituan.com/about" title="">关于我们</a></li></ul></div></div><div class="m-fixed-button" style="opacity: 100; top: 617px;"><div class="m-wrapper"><div class="m-qrcode"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAAAjklEQVRIx81V2xHAIAjTnruyhmuwbb96Z6kYOJWaTx6SKGBm5poMIKJXnDXvsgTNoGgMrUxR3nYFnwLMXHusNTvyx73BA+1ONTvyb1eQvXNgjQ9T4EbbLaizQhQsKTBSsVyBvLbi7YoWaDZS6gzaDPNeUfM2lXOgHSjz4ncRYub92c7Zpgjnb1ON8e9vcAOBkF++GF/4vQAAAABJRU5ErkJggg=="></div><div class="m-go-top"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAAB/ElEQVR42u3bX0rcUBiG8cc/o+5CwW5CL0rpJirY+2zDbZzbti6klXYhCm7B0Ssv7AfqJAMz7zk5n/A+VzMhTL78IOSQITullCvc1u32HuCjZ0AxA4oZUMyAYgYUM6CYAcUMKGZAMQOKGVDMgGIGFDOgmAHFDChmQDEDihlQzIBiBhQzoJgBxQwoZkAxA4rt9x5gTQ/Ab2AP+Awc9h5orKyAD8DPYRjuAUopt8AlcNR7sPdlvITf4AEMw3AHXAPL3sO9LxvgCl6UFTET4ApeKeVTKeUkvmdEzAI4igdcAJeZETMALpnG2wcWJEbsDbgEfozgfePtCiEtYk/AdXiLkf1TIvYC3BQvWof42ONEegBuixdNIf6iA+LcgCpelAZxTsAxvFM2x4tSIM4FOIV3wXZ4USAex4a5EecAbIUXLYDvvRBbA7bGi7ohtgScCy/qgtgKcG68aAqx2TqxBWAvvGgM8ZZGiLUBe+NFY3fnJog1AbPgRQdMIz7VOkhNwD+J8KIpxJtaB2hyE0mCF60g1myn4iv/j8BfXp7jnZED73VPwL//n895gZWr+bfmIfB1ZpRNOgC+1P7R3k+kP3wGFDOgmAHFDChmQDEDihlQzIBiBhQzoJgBxQwoZkAxA4oZUMyAYgYUM6CYAcUMKGZAMQOKGVDMgGIGFDOg2DOEU/uBJ0Ro/gAAAABJRU5ErkJggg=="></div></div><div class="qrcode-container"><div class="qr_code"><p class="desktop_qr_tittle">扫码关注技术博客</p><img src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/7d0f734bcd029f452d415ce7d521a0d9632811.gif" class="qr_img"></div></div></div></div><script src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/post.js"></script><script async="" src="./新一代开源Android渠道包生成工具Walle - 美团技术团队_files/js(2)"></script><script>try{window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-55279261-1');}catch(e){}</script><script>try{var _hmt=_hmt||[];var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?7158c55a533ed0cf57dede022b1e6aed";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);}catch(e){}</script></body></html>